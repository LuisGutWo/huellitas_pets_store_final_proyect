@use "../../../shared/styles/styles.scss" as styles;
@use "../../../shared/styles/tokens" as tokens;

// ============================================
// Product Card Component
// ============================================

.product-card {
    position: relative;
    background-color: tokens.$color-bg-primary;
    border-radius: tokens.$radius-lg;
    box-shadow: tokens.$shadow-card;
    border: none;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%;
    @include tokens.transition(all, tokens.$duration-normal, tokens.$ease-in-out);

    // Loading state
    &--loading {
        .product-card__image-container::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.6) 50%,
                    transparent 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
    }

    // Hover effect
    @include tokens.hover-capable {
        &:hover {
            box-shadow: tokens.$shadow-card-hover;
            transform: translateY(-2px);

            .product-card__actions {
                opacity: 1;
                transform: translateY(0);
            }
        }
    }

    // ============================================
    // Discount Badge
    // ============================================
    &__badge {
        position: absolute;
        top: tokens.$spacing-3;
        right: tokens.$spacing-3;
        background: tokens.$color-error-500;
        color: tokens.$color-text-inverse;
        padding: tokens.$spacing-1 tokens.$spacing-3;
        border-radius: tokens.$radius-full;
        font-size: tokens.$font-size-xs;
        font-weight: tokens.$font-weight-bold;
        z-index: 20;
        box-shadow: tokens.$shadow-sm;
        @include tokens.animate(scaleIn, 0.3s, tokens.$ease-bounce);
    }

    // ============================================
    // Quick Actions (Favorite & Info)
    // ============================================
    &__actions {
        position: absolute;
        top: tokens.$spacing-3;
        left: tokens.$spacing-3;
        display: flex;
        gap: tokens.$spacing-2;
        opacity: 0;
        transform: translateY(-8px);
        @include tokens.transition(all, tokens.$duration-slow, tokens.$ease-out);
        z-index: 20;

        @include tokens.respond-to-max('md') {
            opacity: 1;
            transform: translateY(0);
        }
    }

    &__action-btn {
        width: 36px;
        height: 36px;
        border-radius: tokens.$radius-full;
        background: tokens.$color-bg-primary;
        border: none;
        box-shadow: tokens.$shadow-md;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: tokens.$color-text-secondary;
        @include tokens.transition(all, tokens.$duration-normal, tokens.$ease-in-out);

        &:hover {
            transform: scale(1.08);
            color: tokens.$color-text-primary;
            box-shadow: tokens.$shadow-lg;
        }

        &:active {
            transform: scale(0.98);
        }

        &--favorite {
            &.active {
                background: tokens.$color-error-500;
                color: tokens.$color-text-inverse;

                &:hover {
                    background: tokens.$color-error-600;
                }
            }
        }

        &--delete {
            width: 40px;
            height: 40px;
            background: tokens.$color-error-500;
            color: tokens.$color-text-inverse;

            &:hover {
                background: tokens.$color-error-600;
                transform: scale(1.08);
                box-shadow: tokens.$shadow-lg;
            }

            &:active {
                transform: scale(0.95);
            }
        }
    }

    // Delete button for favorites view
    &__delete-btn {
        position: absolute;
        top: tokens.$spacing-3;
        left: tokens.$spacing-3;
        z-index: 20;
    }

    // ============================================
    // Product Image
    // ============================================
    &__image-container {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        padding: tokens.$spacing-4;
        overflow: hidden;
        aspect-ratio: 4 / 3;
        background: linear-gradient(135deg, tokens.$color-neutral-50 0%, tokens.$color-bg-primary 100%);

        .optimized-image {
            width: 100%;
            height: 100%;
            border-radius: 0;
            background: transparent;
        }
    }

    &__image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        @include tokens.transition(transform, tokens.$duration-slower, tokens.$ease-in-out);

        @include tokens.hover-capable {
            &:hover {
                transform: scale(1.05);
            }
        }
    }

    // ============================================
    // Card Content
    // ============================================
    &__content {
        display: flex;
        flex-direction: column;
        padding: tokens.$spacing-4;
        flex: 1;
    }

    &__title {
        @include tokens.text-base;
        font-weight: tokens.$font-weight-semibold;
        color: tokens.$color-text-primary;
        margin-bottom: tokens.$spacing-2;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        min-height: 2.5rem;
        line-height: 1.25;
        @include tokens.transition(color, tokens.$duration-normal, tokens.$ease-in-out);

        &:hover {
            color: tokens.$color-primary-500;
        }
    }

    // ============================================
    // Rating
    // ============================================
    &__rating {
        display: flex;
        align-items: center;
        gap: tokens.$spacing-2;
        margin-bottom: tokens.$spacing-3;

        &-stars {
            display: flex;
            gap: 2px;
        }

        &-count {
            @include tokens.text-xs;
            color: tokens.$color-text-secondary;
        }
    }

    // ============================================
    // Price
    // ============================================
    &__price-container {
        display: flex;
        align-items: center;
        gap: tokens.$spacing-3;
        margin-bottom: tokens.$spacing-4;
        flex-wrap: wrap;
    }

    &__price {
        font-size: tokens.$font-size-xl;
        font-weight: tokens.$font-weight-bold;
        color: tokens.$color-primary-500;

        &--discounted {
            color: tokens.$color-success-600; // Verde para indicar ahorro
            font-size: tokens.$font-size-2xl; // Más grande cuando hay descuento
        }
    }

    &__price-old {
        @include tokens.text-small;
        color: tokens.$color-text-tertiary;
        text-decoration: line-through;
        order: -1; // Asegura que aparezca primero
    }

    // ============================================
    // Add to Cart Button
    // ============================================
    &__add-button {
        width: 100%;
        padding: tokens.$spacing-3 tokens.$spacing-4;
        background: tokens.$color-primary-500;
        color: tokens.$color-text-inverse;
        border: none;
        border-radius: tokens.$radius-md;
        font-size: tokens.$font-size-sm;
        font-weight: tokens.$font-weight-semibold;
        text-transform: uppercase;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        @include tokens.transition(all, tokens.$duration-normal, tokens.$ease-in-out);
        letter-spacing: 0.5px;

        &:hover:not(:disabled) {
            background: tokens.$color-primary-600;
            transform: translateY(-1px);
            box-shadow: tokens.$shadow-button-hover;
        }

        &:active:not(:disabled) {
            transform: translateY(0);
        }

        &:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        &--added {
            background: tokens.$color-success-500;

            &:hover {
                background: tokens.$color-success-600;
            }
        }

        @include tokens.focus-ring(tokens.$color-primary-300);
    }
}

// ============================================
// Animations
// ============================================
@keyframes shimmer {
    0% {
        background-position: -200% 0;
    }

    100% {
        background-position: 200% 0;
    }
}

// ============================================
// Legacy styles (mantener compatibilidad temporal)
// ============================================
.card-favorite-icon {
    @extend .product-card__actions;
}

.card-image-container {
    @extend .product-card__image-container;
}

.card-image {
    @extend .product-card__image;
}

.card-body {
    @extend .product-card__content;
}

.card-body-title {
    @extend .product-card__title;
}

.card-body-price {
    @extend .product-card__price;
}

.card-buttons,
.category-buttons {
    @extend .product-card__add-button;
}

// ============================================
// Responsive Adjustments
// ============================================

@include tokens.respond-to-max('md') {
    .product-card {
        &__badge {
            top: tokens.$spacing-2;
            right: tokens.$spacing-2;
            padding: tokens.$spacing-1 tokens.$spacing-2;
            font-size: 0.625rem;
        }

        &__action-btn {
            width: 32px;
            height: 32px;
        }

        &__image-container {
            padding: tokens.$spacing-3;
        }

        &__content {
            padding: tokens.$spacing-3;
        }

        &__title {
            font-size: tokens.$font-size-sm;
            min-height: 2.2rem;
        }

        &__price {
            font-size: tokens.$font-size-lg;
        }

        &__add-button {
            padding: tokens.$spacing-2 tokens.$spacing-3;
            font-size: 0.75rem;
        }
    }
}

@include tokens.respond-to-max('sm') {
    .product-card {
        &__badge {
            font-size: 0.625rem;
        }

        &__actions {
            gap: tokens.$spacing-1;
        }

        &__action-btn {
            width: 28px;
            height: 28px;

            svg {
                font-size: 1rem;
            }
        }

        &__title {
            font-size: 0.8125rem;
            min-height: 2rem;
        }

        &__price {
            font-size: tokens.$font-size-base;

            &--discounted {
                font-size: tokens.$font-size-lg; // Más grande en móvil cuando hay descuento
            }
        }

        &__price-old {
            font-size: 0.7rem;
        }

        &__rating-count {
            font-size: 0.65rem;
        }
    }
}

// ============================================
// Accessibility & Motion Preferences
// ============================================

@include tokens.prefers-reduced-motion {
    .product-card {
        animation: none !important;
        transition: none !important;

        &__image,
        &__add-button,
        &__action-btn {
            transition: none !important;
        }

        &:hover {
            transform: none !important;
        }
    }
}

// Focus visible for keyboard navigation
.product-card__add-button:focus-visible,
.product-card__action-btn:focus-visible {
    outline: 2px solid tokens.$color-primary-500;
    outline-offset: 2px;
}